(()=>{"use strict";var t=document.querySelector(".page"),e=t.querySelector(".places__list"),n=t.querySelector(".popup_type_image"),r=n.querySelector(".popup__image"),o=n.querySelector(".popup__caption"),a=t.querySelector(".popup_edit_profile-image"),c=t.querySelectorAll(".popup"),i=t.querySelector(".profile__title"),u=t.querySelector(".profile__description"),s=t.querySelector(".profile__image"),l=document.forms["edit-profile"],d=l.name,f=l.description,p=document.forms["edit-image-profile"],_=p.link,h=document.forms["new-place"],v=h["place-name"],m=h.link,y=document.forms["delete-card"],b=t.querySelector(".popup_delete-card"),S=t.querySelector(".error__connect"),g=S.querySelector(".error__title"),C=S.querySelector(".error__text"),L=t.querySelector(".places"),q=t.querySelector(".profile__add-button"),E=t.querySelector(".profile__edit-button"),x=t.querySelector(".popup_type_new-card"),k=t.querySelector(".popup_type_edit"),A=t.querySelectorAll(".popup__close"),T=t.querySelector("#card-template").content,J={idPost:"",target:""},U={name:"",about:"",avatar:"",id:""},P={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};function w(t){t.classList.add("popup_is-opened"),document.addEventListener("keydown",O)}function j(t){t.classList.remove("popup_is-opened"),document.removeEventListener("keydown",O)}function O(t){"Escape"===t.key&&j(document.querySelector(".popup_is-opened"))}function B(t){t.target.closest(".popup__content")||j(t.target)}var M={baseUrl:"https://nomoreparties.co/v1/wff-cohort-25",headers:{authorization:"38a628a1-9dfc-4f10-bcd6-8a3b9999ace6","Content-Type":"application/json"},ressJson:function(t){return t.ok?t.json():Promise.reject(t.status)},err:function(t){408===t?(g.textContent="Истикло время ожидания.",C.textContent="Попробуйте снова."):429===t?(g.textContent="Слишком много запросов",C.textContent="Подождите немного и попробуйте снова"):404===t?(g.textContent="Информация не найдена",C.textContent="Возможно были изменения ранее"):500===t?(g.textContent="Внутренняя ошибка сервера",C.textContent="Попробуйте перезагрузить страницу."):503===t?(g.textContent="Сервис недоступен",C.textContent="Попробуйте перезагрузить страницу."):(g.textContent="Неизвестная ошибка",C.textContent="Попробуйте перезагрузить страницу."),S.setAttribute("style","display: block;"),setTimeout((function(){return S.setAttribute("style","display: none;")}),3e3)}};function D(t,e,n){var r;t.target.classList.value.includes("card__like-button_is-active")?(r=e._id,fetch("".concat(M.baseUrl,"/cards/likes/").concat(r),{method:"DELETE",headers:M.headers})).then(M.ressJson).then((function(e){t.target.classList.remove("card__like-button_is-active"),n.textContent=e.likes.length})).catch((function(t){return M.err(t)})):function(t){return fetch("".concat(M.baseUrl,"/cards/likes/").concat(t),{method:"PUT",headers:M.headers})}(e._id).then(M.ressJson).then((function(e){t.target.classList.add("card__like-button_is-active"),n.textContent=e.likes.length})).catch((function(t){return M.err(t)}))}function N(t,e,n,r,o){var a=T.querySelector(".card").cloneNode(!0),c=a.querySelector(".card__image"),i=a.querySelector(".card__delete-button"),u=a.querySelector(".card__like-button"),s=a.querySelector(".card__like-info");return a.querySelector(".card__title").textContent=t.name,c.src=t.link,c.alt=t.name,s.textContent=t.likes.length,t.owner._id!==e&&i.classList.add("card__delete-button_hidden"),t.likes.forEach((function(t){t._id===e&&u.classList.add("card__like-button_is-active")})),i.addEventListener("click",(function(e){return n(e,t._id)})),u.addEventListener("click",(function(e){return r(e,t,s)})),c.addEventListener("click",o),a}function I(t,e,n,r){var o=t.querySelector(".".concat(e.id,"-error"));e.validity.patternMismatch?(o.textContent=e.dataset.errorMessage,o.classList.add("".concat(r.errorClass)),e.classList.add("".concat(r.inputErrorClass))):(e.classList.add("".concat(r.inputErrorClass)),o.textContent=n,o.classList.add("".concat(r.errorClass)))}function H(t,e,n){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?(e.disabled=!1,e.classList.remove("".concat(n.inactiveButtonClass))):(e.disabled=!0,e.classList.add("".concat(n.inactiveButtonClass)))}function z(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function $(t){Array.from(document.querySelectorAll("".concat(t.formSelector))).forEach((function(e){(function(t,e){var n=Array.from(t.querySelectorAll("".concat(e.inputSelector))),r=t.querySelector("".concat(e.submitButtonSelector));n.forEach((function(o){o.addEventListener("input",(function(){!function(t,e,n){void 0!==e.attributes.maxlenght?e.value.length>e.attributes.maxlenght.value?I(t,e,"Максимальное количество символов: ".concat(e.attributes.maxlenght.value,". Длина текста сейчас: ").concat(e.value.length," символ."),n):(e.validity.valid,I(t,e,e.validationMessage,n)):e.validity.valid?function(t,e,n){var r=t.querySelector(".".concat(e.id,"-error"));r.classList.remove("".concat(n.errorClass)),r.textContent="",e.classList.remove("".concat(n.inputErrorClass))}(t,e,n):I(t,e,e.validationMessage,n)}(t,o,e),H(n,r,e)})),H(n,r,e)}))})(e,t),e.addEventListener("submit",(function(t){t.preventDefault()}))}))}function F(t,e){var n=t.target.querySelector(".button");e?(n.textContent="Сохранение...",n.classList.add("popup__button-seve")):(n.textContent="Сохранить",n.classList.remove("popup__button-seve"),$(P))}function G(t){w(n),r.src=t.currentTarget.src,r.alt=t.currentTarget.alt,o.textContent=t.currentTarget.alt}function K(t,e){w(b),J.idPost=e,J.target=t.target}function Q(t){t.reset(),t.querySelectorAll(".popup__error").forEach((function(t){return t.textContent=""}))}L.classList.add("load"),Promise.all([fetch("".concat(M.baseUrl,"/cards"),{headers:M.headers}).then(M.ressJson),fetch("".concat(M.baseUrl,"/users/me"),{headers:M.headers}).then(M.ressJson)]).then((function(t){var n,r,o=(r=2,function(t){if(Array.isArray(t))return t}(n=t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,a,c,i=[],u=!0,s=!1;try{if(a=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=a.call(n)).done)&&(i.push(r.value),i.length!==e);u=!0);}catch(t){s=!0,o=t}finally{try{if(!u&&null!=n.return&&(c=n.return(),Object(c)!==c))return}finally{if(s)throw o}}return i}}(n,r)||function(t,e){if(t){if("string"==typeof t)return z(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?z(t,e):void 0}}(n,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),a=o[0],c=o[1];U.name=c.name,U.about=c.about,U.avatar=c.avatar,U.id=c._id,function(t){s.setAttribute("style","background-image: url('".concat(t.avatar,"')")),i.textContent=t.name,u.textContent=t.about}(U),a.forEach((function(t){e.append(N(t,U.id,K,D,G))}))})).then((function(){return L.classList.remove("load")})).catch((function(t){return M.err(t)})),$(P),c.forEach((function(t){t.addEventListener("click",B)})),p.addEventListener("submit",(function(t){return function(t,e){F(t,!0),function(t){return fetch("".concat(M.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:M.headers,body:JSON.stringify({avatar:t})})}(e).then((function(){s.setAttribute("style","background-image: url('".concat(e,"')"))})).then((function(){j(a),t.target.reset()})).catch((function(t){return M.err(t)})).finally((function(){return F(t)}))}(t,_.value)})),y.addEventListener("submit",(function(t){return function(t,e,n,r){t.preventDefault(),function(t){return fetch("".concat(M.baseUrl,"/cards/").concat(t.idPost),{method:"DELETE",headers:M.headers})}(e).then(M.ressJson).then((function(){return e.target.closest(".card").remove()})).then((function(){e.idPost="",e.target="",n(r)})).catch((function(t){return M.err(t)}))}(t,J,j,b)})),s.addEventListener("click",(function(){Q(p),w(a)})),q.addEventListener("click",(function(){Q(h),w(x)})),E.addEventListener("click",(function(t){Q(l),w(k),d.value=i.textContent,f.value=u.textContent})),l.addEventListener("submit",(function(t){return function(t,e,n){F(t,!0),function(t,e){return fetch("".concat(M.baseUrl,"/users/me"),{method:"PATCH",headers:M.headers,body:JSON.stringify({name:t,about:e})})}(e,n).then(M.ressJson).then((function(t){i.textContent=t.name,u.textContent=t.about})).then((function(){return j(k)})).catch((function(t){return M.err(t)})).finally((function(){return F(t)}))}(t,d.value,f.value)})),h.addEventListener("submit",(function(t){return function(t,n){F(t,!0);var r={};r.name=v.value,r.link=m.value,function(t){return fetch("".concat(M.baseUrl,"/cards"),{method:"POST",headers:M.headers,body:JSON.stringify({name:t.name,link:t.link})})}(r).then(M.ressJson).then((function(t){e.prepend(N(t,n,K,D,G))})).then((function(){F(t),j(x),t.target.reset()})).catch((function(t){M.err(t)})).finally((function(){F(t)}))}(t,U.id)})),A.forEach((function(t){var e=t.closest(".popup");t.addEventListener("click",(function(t){j(e)}))}))})();