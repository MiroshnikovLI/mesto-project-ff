(()=>{"use strict";var t=document.querySelector(".page"),e=t.querySelector(".places__list"),n=t.querySelector(".popup_type_image"),r=n.querySelector(".popup__image"),o=n.querySelector(".popup__caption"),c=t.querySelector(".popup_edit_profile-image"),a=t.querySelectorAll(".popup"),i=t.querySelector(".profile__title"),u=t.querySelector(".profile__description"),s=t.querySelector(".profile__image"),l=document.forms["edit-profile"],d=l.name,f=l.description,p=document.forms["edit-image-profile"],_=p.link,m=document.forms["new-place"],h=m["place-name"],y=m.link,v=document.forms["delete-card"],b=t.querySelector(".popup_delete-card"),S=t.querySelector(".error__connect"),C=S.querySelector(".error__title"),g=S.querySelector(".error__text"),L=t.querySelector(".places"),q=t.querySelector(".profile__add-button"),E=t.querySelector(".profile__edit-button"),k=t.querySelector(".popup_type_new-card"),x=t.querySelector(".popup_type_edit"),A=t.querySelectorAll(".popup__close"),T=t.querySelector("#card-template").content,J={idPost:"",target:""},U={name:"",about:"",avatar:"",id:""},P={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};function w(t){t.classList.add("popup_is-opened"),document.addEventListener("keydown",O)}function j(t){t.classList.remove("popup_is-opened"),document.removeEventListener("keydown",O)}function O(t){"Escape"===t.key&&j(document.querySelector(".popup_is-opened"))}function B(t){t.target.closest(".popup__content")||j(t.target)}var D={baseUrl:"https://nomoreparties.co/v1/wff-cohort-25",headers:{authorization:"38a628a1-9dfc-4f10-bcd6-8a3b9999ace6","Content-Type":"application/json"},ressJson:function(t){return t.ok?t.json():Promise.reject(t.status)},err:function(t){408===t?(C.textContent="Истикло время ожидания.",g.textContent="Попробуйте снова."):429===t?(C.textContent="Слишком много запросов",g.textContent="Подождите немного и попробуйте снова"):404===t?(C.textContent="Информация не найдена",g.textContent="Возможно были изменения ранее"):500===t?(C.textContent="Внутренняя ошибка сервера",g.textContent="Попробуйте перезагрузить страницу."):503===t?(C.textContent="Сервис недоступен",g.textContent="Попробуйте перезагрузить страницу."):(C.textContent="Неизвестная ошибка",g.textContent="Попробуйте перезагрузить страницу."),S.setAttribute("style","display: block;"),setTimeout((function(){return S.setAttribute("style","display: none;")}),3e3)}};function M(t,e,n){var r;t.target.classList.value.includes("card__like-button_is-active")?(r=e._id,fetch("".concat(D.baseUrl,"/cards/likes/").concat(r),{method:"DELETE",headers:D.headers})).then(D.ressJson).then((function(e){t.target.classList.remove("card__like-button_is-active"),n.textContent=e.likes.length})).catch((function(t){return D.err(t)})):function(t){return fetch("".concat(D.baseUrl,"/cards/likes/").concat(t),{method:"PUT",headers:D.headers})}(e._id).then(D.ressJson).then((function(e){t.target.classList.add("card__like-button_is-active"),n.textContent=e.likes.length})).catch((function(t){return D.err(t)}))}function N(t,e,n,r,o){var c=T.querySelector(".card").cloneNode(!0),a=c.querySelector(".card__image"),i=c.querySelector(".card__delete-button"),u=c.querySelector(".card__like-button"),s=c.querySelector(".card__like-info");return c.querySelector(".card__title").textContent=t.name,a.src=t.link,a.alt=t.name,s.textContent=t.likes.length,t.owner._id!==e&&i.classList.add("card__delete-button_hidden"),t.likes.forEach((function(t){t._id===e&&u.classList.add("card__like-button_is-active")})),i.addEventListener("click",(function(e){return n(e,t._id)})),u.addEventListener("click",(function(e){return r(e,t,s)})),a.addEventListener("click",o),c}function I(t,e,n){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?(e.disabled=!1,e.classList.remove("".concat(n.inactiveButtonClass))):(e.disabled=!0,e.classList.add("".concat(n.inactiveButtonClass)))}function H(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function z(t){Array.from(document.querySelectorAll("".concat(t.formSelector))).forEach((function(e){(function(t,e){var n=Array.from(t.querySelectorAll("".concat(e.inputSelector))),r=t.querySelector("".concat(e.submitButtonSelector));n.forEach((function(o){o.addEventListener("input",(function(){!function(t,e,n){e.validity.valid?function(t,e,n){var r=t.querySelector(".".concat(e.id,"-error"));r.classList.remove("".concat(n.errorClass)),r.textContent="",e.classList.remove("".concat(n.inputErrorClass))}(t,e,n):function(t,e,n,r){var o=t.querySelector(".".concat(e.id,"-error"));e.validity.patternMismatch?(o.textContent=e.dataset.errorMessage,o.classList.add("".concat(r.errorClass)),e.classList.add("".concat(r.inputErrorClass))):(e.classList.add("".concat(r.inputErrorClass)),o.textContent=n,o.classList.add("".concat(r.errorClass)))}(t,e,e.validationMessage,n)}(t,o,e),I(n,r,e)})),I(n,r,e)}))})(e,t),e.addEventListener("submit",(function(t){t.preventDefault()}))}))}function $(t,e){var n=t.target.querySelector(".button");e?(n.textContent="Сохранение...",n.classList.add("popup__button-seve")):(n.textContent="Сохранить",n.classList.remove("popup__button-seve"),z(P))}function F(t){w(n),r.src=t.currentTarget.src,r.alt=t.currentTarget.alt,o.textContent=t.currentTarget.alt}function G(t,e){w(b),J.idPost=e,J.target=t.target}L.classList.add("load"),Promise.all([fetch("".concat(D.baseUrl,"/cards"),{headers:D.headers}).then(D.ressJson),fetch("".concat(D.baseUrl,"/users/me"),{headers:D.headers}).then(D.ressJson)]).then((function(t){var n,r,o=(r=2,function(t){if(Array.isArray(t))return t}(n=t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,c,a,i=[],u=!0,s=!1;try{if(c=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=c.call(n)).done)&&(i.push(r.value),i.length!==e);u=!0);}catch(t){s=!0,o=t}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(s)throw o}}return i}}(n,r)||function(t,e){if(t){if("string"==typeof t)return H(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?H(t,e):void 0}}(n,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),c=o[0],a=o[1];U.name=a.name,U.about=a.about,U.avatar=a.avatar,U.id=a._id,function(t){s.setAttribute("style","background-image: url('".concat(t.avatar,"')")),i.textContent=t.name,u.textContent=t.about}(U),c.forEach((function(t){e.append(N(t,U.id,G,M,F))}))})).then((function(){return L.classList.remove("load")})).catch((function(t){return D.err(t)})),z(P),a.forEach((function(t){t.addEventListener("click",B)})),p.addEventListener("submit",(function(t){return function(t,e){$(t,!0),function(t){return fetch("".concat(D.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:D.headers,body:JSON.stringify({avatar:t})})}(e).then((function(){s.setAttribute("style","background-image: url('".concat(e,"')"))})).then((function(){j(c),t.target.reset()})).catch((function(t){return D.err(t)})).finally((function(){return $(t)}))}(t,_.value)})),v.addEventListener("submit",(function(t){return function(t,e,n,r){t.preventDefault(),function(t){return fetch("".concat(D.baseUrl,"/cards/").concat(t.idPost),{method:"DELETE",headers:D.headers})}(e).then(D.ressJson).then((function(){return e.target.closest(".card").remove()})).then((function(){e.idPost="",e.target="",n(r)})).catch((function(t){return D.err(t)}))}(t,J,j,b)})),s.addEventListener("click",(function(){return w(c)})),q.addEventListener("click",(function(){return w(k)})),E.addEventListener("click",(function(t){w(x),d.value=i.textContent,f.value=u.textContent})),l.addEventListener("submit",(function(t){return function(t,e,n){$(t,!0),function(t,e){return fetch("".concat(D.baseUrl,"/users/me"),{method:"PATCH",headers:D.headers,body:JSON.stringify({name:t,about:e})})}(e,n).then(D.ressJson).then((function(t){i.textContent=t.name,u.textContent=t.about})).then((function(){return j(x)})).catch((function(t){return D.err(t)})).finally((function(){return $(t)}))}(t,d.value,f.value)})),m.addEventListener("submit",(function(t){return function(t,n){$(t,!0);var r={};r.name=h.value,r.link=y.value,function(t){return fetch("".concat(D.baseUrl,"/cards"),{method:"POST",headers:D.headers,body:JSON.stringify({name:t.name,link:t.link})})}(r).then(D.ressJson).then((function(t){e.prepend(N(t,n,G,M,F))})).then((function(){$(t),j(k),t.target.reset()})).catch((function(t){D.err(t)})).finally((function(){$(t)}))}(t,U.id)})),A.forEach((function(t){var e=t.closest(".popup");t.addEventListener("click",(function(t){j(e)}))}))})();