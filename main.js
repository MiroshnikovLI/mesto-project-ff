(()=>{"use strict";var e=document.querySelector(".page"),t=e.querySelector(".places__list"),r=e.querySelector(".popup_type_image"),n=r.querySelector(".popup__image"),o=r.querySelector(".popup__caption"),c=e.querySelector(".profile__title"),a=e.querySelector(".profile__description"),s=e.querySelector(".popup_edit_profile-image"),i=e.querySelector(".profile__image"),u=document.forms["edit-profile"],d=document.forms["new-place"],l=u.name,p=u.description,_=d["place-name"],f=d.link,h=e.querySelector(".error__connect"),m=document.forms["delete-card"],v=e.querySelector(".popup_delete-card"),y=document.forms["edit-image-profile"],g=y.link,b=e.querySelector(".profile__add-button"),k=e.querySelector(".profile__edit-button"),S=e.querySelector(".popup_type_new-card"),q=e.querySelector(".popup_type_edit"),E=e.querySelectorAll(".popup__close"),L=e.querySelector("#card-template").content;function C(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",x),e.addEventListener("click",T)}function J(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",x),e.removeEventListener("click",T)}function x(e){"Escape"===e.key&&J(document.querySelector(".popup_is-opened"))}function T(e){e.target.closest(".popup__content")||J(document.querySelector(".popup_is-opened"))}var U={baseUrl:"https://nomoreparties.co/v1/wff-cohort-25",headers:{authorization:"38a628a1-9dfc-4f10-bcd6-8a3b9999ace6","Content-Type":"application/json"},ressJson:function(e){return e.ok?e.json():Promise.reject(e.status)},err:function(e){h.setAttribute("style","display: block;"),setTimeout((function(){return h.setAttribute("style","display: none;")}),3e3)}};function P(e,t,r){e.target.classList.value.includes("card__like-button_is-active")?fetch("".concat(U.baseUrl,"/cards/likes/").concat(t._id),{method:"DELETE",headers:U.headers}).then(U.ressJson).then((function(t){e.target.classList.remove("card__like-button_is-active"),r.textContent=t.likes.length})).catch(U.err):fetch("".concat(U.baseUrl,"/cards/likes/").concat(t._id),{method:"PUT",headers:U.headers}).then(U.ressJson).then((function(t){e.target.classList.add("card__like-button_is-active"),r.textContent=t.likes.length})).catch(U.err)}function w(e,t,r,n){var o=L.querySelector(".card").cloneNode(!0),c=o.querySelector(".card__image"),a=o.querySelector(".card__delete-button"),s=o.querySelector(".card__like-button"),i=o.querySelector(".card__like-info");return o.querySelector(".card__title").textContent=e.name,c.src=e.link,c.alt=e.name,i.textContent=e.likes.length,fetch("".concat(U.baseUrl,"/users/me"),{headers:U.headers}).then(U.ressJson).then((function(t){e.owner._id!==t._id&&a.classList.add("card__delete-button_hidden"),e.likes.forEach((function(e){e._id===t._id&&s.classList.add("card__like-button_is-active")}))})).catch(U.err),a.addEventListener("click",(function(r){t(v),A.idPost=e._id,A.target=r.target})),s.addEventListener("click",(function(t){return r(t,e,i)})),c.addEventListener("click",n),o}var A={idPost:"",target:""};function D(e){C(r),n.src=e.currentTarget.src,n.alt=e.currentTarget.alt,o.textContent=e.currentTarget.alt}m.addEventListener("submit",(function(e){e.preventDefault(),console.log(A),fetch("".concat(U.baseUrl,"/cards/").concat(A.idPost),{method:"DELETE",headers:U.headers}).then(U.ressJson).then((function(e){J(v),A.target.closest(".card").remove(),A.idPost="",A.target=""})).catch(U.err)})),i.addEventListener("click",(function(){return C(s)})),b.addEventListener("click",(function(){return C(S)})),k.addEventListener("click",(function(){C(q),l.value=c.textContent,p.value=a.textContent})),u.addEventListener("submit",(function(e){return function(e,t,r){e.preventDefault(),fetch("".concat(U.baseUrl,"/users/me"),{method:"PATCH",headers:U.headers,body:JSON.stringify({name:t,about:r})}).then(U.ressJson).then((function(e){c.textContent=e.name,a.textContent=e.about})).catch(U.err),J(e.target.closest(".popup_is-opened"))}(e,l.value,p.value)})),d.addEventListener("submit",(function(e){return function(e){e.preventDefault();var r={};r.name=_.value,r.link=f.value,fetch("".concat(U.baseUrl,"/cards"),{method:"POST",headers:U.headers,body:JSON.stringify({name:r.name,link:r.link})}).then(U.ressJson).then((function(e){t.prepend(w(e,C,P,D))})).catch(U.err),e.target.reset(),J(e.target.closest(".popup_is-opened"))}(e)})),E.forEach((function(e){e.addEventListener("click",(function(e){J(e.target.closest(".popup_is-opened"))}))})),y.addEventListener("submit",(function(e){e.preventDefault(),function(e,t){console.log(e),fetch("https://nomoreparties.co/v1/wff-cohort-25/users/me/avatar",{method:"PATCH",headers:U.headers,body:JSON.stringify({avatar:t})}).then(U.ressJson).then((function(r){i.setAttribute("style","background-image: url('".concat(t,"')")),e.target.reset(),J(e.target.closest(".popup_is-opened"))})).catch(U.err)}(e,g.value)})),fetch("".concat(U.baseUrl,"/cards"),{headers:U.headers}).then(U.ressJson).then((function(e){for(var r=0;r<e.length;r++)t.append(w(e[r],C,P,D));console.log(e)})).catch(U.err);var N=document.querySelector(".profile__image"),O=document.querySelector(".profile__title"),j=document.querySelector(".profile__description");fetch("".concat(U.baseUrl,"/users/me"),{headers:U.headers}).then(U.ressJson).then((function(e){N.setAttribute("style","background-image: url('".concat(e.avatar,"')")),O.textContent=e.name,j.textContent=e.about})).catch(U.err)})();